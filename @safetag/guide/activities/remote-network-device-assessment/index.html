<!DOCTYPE html><!--if lt IE 7<html class="ie ie6" lang="en">--><!--if IE 7<html class="ie ie7" lang="en">--><!--if IE 8<html class="ie ie8" lang="en">--><!--if (gte IE 9)|!(IE)<!--><html lang="en"> <!--
--><html><head><meta charset="utf8"><title> &middot; SAFETAG</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><link href="/safetag/@safetag/guide/filter.js/assets/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css"><link href="/safetag/@safetag/guide/filter.js/assets/css/jquery-ui-1.10.2.custom.min.css" media="screen" rel="stylesheet" type="text/css"><link href="/safetag/@safetag/guide/filter.js/assets/css/stream.css" media="screen" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/safetag/@safetag/guide/css/skeleton.css"><link rel="stylesheet" href="/safetag/@safetag/guide/css/selection.css"><link rel="stylesheet" href="/safetag/@safetag/guide/css/site.css"><link rel="stylesheet" href="/safetag/@safetag/guide/css/fonts.css"><script src="/safetag/@safetag/guide/filter.js/assets/js/jquery-1.11.3.min.js" type="text/javascript"></script><script src="/safetag/@safetag/guide/filter.js/assets/js/jquery-ui-1.10.2.custom.min.js" type="text/javascript"></script><script src="/safetag/@safetag/guide/filter.js/assets/js/jquery-ui-1.10.2.custom.min.js" type="text/javascript"></script><script src="/safetag/@safetag/guide/js/js-yaml.min.js"></script><script src="/safetag/@safetag/guide/js/sortable.min.js"></script><script src="/safetag/@safetag/guide/js/lodash.min.js"></script><script src="/safetag/@safetag/guide/js/filter.js"></script><script src="/safetag/@safetag/guide/js/anchor.min.js"></script><script src="/safetag/@safetag/guide/js/site.js"></script><link rel="shortcut icon" href="/safetag/@safetag/guide/img/favicon.ico"><link rel="apple-touch-icon" href="/safetag/@safetag/guide/img/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="72x72" href="/safetag/@safetag/guide/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="114x114" href="/safetag/@safetag/guide/img/apple-touch-icon-114x114.png"><link rel="alternate" type="application/rss+xml" title="RSS" href="/safetag/@safetag/guide/atom.xml"></head><div class="navbar-spacer"></div><nav class="navbar navbar-fixed-top"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link" href="/safetag/@safetag/guide/">Home</a></li><li class="navbar-item"><a class="navbar-link" href="#" data-popover="#codeNavAbout">Methods</a><div class="popover" id="codeNavAbout"><ul class="popover-list"><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/preparation.guide">Preparation</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/context_research.guide">Context Research</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/capacity_assessment.guide">Capacity Assessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/reconnaissance.guide">Reconnaissance</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/network_discovery.guide">Network Discovery</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/network_access.guide">Network Access</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/network_mapping.guide">Network Mapping</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/user_device_assessment.guide">User Device Assessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/vulnerability_scanning.guide">Vulnerability Scanning and Assessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/data_assessment.guide">Data Asssessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/physical_assessment.guide">Physical Assessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/risk_modeling.guide">Process Mapping and Risk Modeling</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/threat_assessment.guide">Threat Assessment</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/responsive_support.guide">Responsive Support</a></li><li class="popover-item"><a class="popover-link" href="/safetag/@safetag/guide/methods/follow_up.guide">Follow Up</a></li></ul></div></li><li class="navbar-item u-pull-right hidden" id="cd-cart-trigger"><a class="navbar-link cd-img-replace cd-cart" href="#0">Plan<i class="glyphicon glyphicon-list-alt"><span>0</span></i></a></li></ul></div></nav><body class="has-docked-nav" data-baseurl="/safetag/@safetag/guide"><div class="container"><div class="row links"><small><div class="crumb u-pull-left"><a href="/safetag/@safetag/guide">Home</a> / Activities  / Remote Network-Device-Assessment</div><div class="utilities u-pull-right"><a href="https://github.com/SAFETAG/SAFETAG/edit/master/en/exercises/remote_network_device_assessment/summary.md">Edit</a> - <a href="https://github.com/SAFETAG/SAFETAG/commits/master/en/exercises/remote_network_device_assessment/summary.md">Changes</a> - <a href="https://github.com/SAFETAG/SAFETAG/blob/master/en/exercises/remote_network_device_assessment/summary.md">Source</a></div></small></div><div class="docs-section"><div class="space"> </div><h1 id="remote-network-and-user-device-assessment">Remote Network and User Device Assessment</h1>
<h2 id="summary">Summary</h2>
<p>This component allows the auditor to work remotely to identify the devices on a host's network, the services that are being used by those devices, and any protections in place, as well as to assess the security of the individual devices on the network.</p>
<h2 id="materials-needed">Materials Needed</h2>
<h6 id="scenario-1">Scenario 1</h6>
<ul>
<li>A machine accessible globally via ssh. It could be a machine or a virtual server</li>
<li>A GNULinux machine on the auditor's side</li>
<li>A machine running Linux or Mac with ssh on the auditee's end. If the audited<br />
organization only has Windows computers, they can use a live distribution, for<br />
example <a href="https://tutorials.ubuntu.com/tutorial/try-ubuntu-before-you-install?_ga=2.100677957.597084418.1503414810-670812192.1503414810#0">Ubuntu Live</a>.
<ul>
<li>If you're using a live Linux distribution, you will probably need to guide<br />
the auditee into changing the BIOS settings for enabling the computer to<br />
boot from a USB stick.</li>
</ul></li>
<li>If we use sshuttle, <code>net-tools</code> needs to be installed on the auditee's side.<br />
This package is installed by default in Ubuntu.</li>
</ul>
<h6 id="scenario-2">Scenario 2</h6>
<p><strong>In the case of remote desktop:</strong></p>
<ul>
<li>Clean PC connected to the local auditee LAN network</li>
<li>Stable and fast Internet connection at both ends</li>
<li>TeamViewer client installed on the local clean machine. (<a href="https://support.microsoft.com/en-us/help/17463/windows-7-connect-to-another-computer-remote-desktop-connection">Windows remote desktop</a> can also be used.)</li>
<li>TeamViewer installed on the auditor's machine</li>
</ul>
<p><strong>In the case of using an in-the-middle trusted VPN server:</strong></p>
<ul>
<li>A PC connected to the local auditee's LAN network</li>
<li>Stable and fast Internet connection at both ends</li>
<li>OpenVPN client installed on the local clean machine</li>
<li>OpenVPN client installed on the auditor's machine</li>
<li>A trusted OpenVPN Server</li>
</ul>
<p><strong>Applications to use</strong>:<br />
<a href="http://www.tightvnc.com/">TightVNC</a><br />
<a href="https://www.teamviewer.com/en/">TeamViewer</a><br />
<a href="https://support.microsoft.com/en-us/help/17463/windows-7-connect-to-another-computer-remote-desktop-connection">Windows remote desktop</a></p>
<h2 id="operational-security">Operational Security</h2>
<h6 id="scenario-1-1">Scenario 1</h6>
<ul>
<li>Make sure that the auditee downloads the Linux image over TLS and guide them through the verification process (instructions for Ubuntu can be found <a href="https://tutorials.ubuntu.com/tutorial/tutorial-how-to-verify-ubuntu#0">here</a>).</li>
<li>When starting a live Linux distribution, make sure the auditee has a secure communication channel with you on a different device than the one that will be rebooted - for example through Signal on an Android phone, or on a different computer.</li>
<li>Warn the auditee that they should not press &quot;install&quot; when the live Linux distribution has started, else their hard disk will be formatted and they will lose their data.</li>
<li>Make sure that a secure communication channel is in place for sending the ssh commands to the auditee.</li>
<li>The server used for the middle connection should be updated and secured, or updated and ephemeral.</li>
<li>Make sure to remove/clean any persistent connections once you are done with auditing.</li>
</ul>
<h2 id="walkthrough">Walkthrough</h2>
<h6 id="scenario-0">Scenario 0</h6>
<p>Instruct the intermediary or the tech person in the organization to follow the instructions in the exercise on <a href="../../methods/network_mapping">Network mapping</a> and on <a href="../../methods/user_device_assessment">User device assessment</a>.</p>
<h6 id="scenario-1-2">Scenario 1</h6>
<p><strong>Legend</strong></p>
<ul>
<li>S: Server - a machine accessible globally via ssh. It could be a machine or a virtual server</li>
<li>A: Auditor's GNULinux machine</li>
<li>C: A machine running GNULinux or Mac with ssh on the auditee's end</li>
</ul>
<p>Instruct the auditee to initiate a connection to the server (S) and set up a reverse ssh server:</p>
<p>Let's assume we have a server named safetag-audit.org (S), and usernames for each auditee called auditee1, auditee2, etc.</p>
<ul>
<li><p>on the auditee's machine (C); the auditee will need to be instructed to run the following commands:</p>
<pre><code>service sshd start
ssh -R 2200:localhost:22 auditee1@safetag-audit.org</code></pre>
<p>(the auditor has to provide the auditee with a password for the password prompt that will appear when this command is entered.)</p>
<p>this will allow any connection to port 2200 on safetag-audit.org (S) to be sent to port 22 on the auditee's machine (C). The remote port is an arbitrary high number port (&gt; 1023); a practice can be established to assign a number to each location and machine.</p>
<p><strong>example</strong>:</p>
<p>the auditee on machine on site 0 could be instructed to run:</p>
<pre><code>ssh -R 2200:localhost:22 auditee0@safetag-audit.org</code></pre>
<p>this will allow the auditee to connect to port 2200 from within safetag-audit.org (S) and have traffic forwarded to port 22 on the auditee's machine (C).</p>
<p>the auditee on machine on site 1 will run:</p>
<pre><code>ssh -R 2210:localhost:22 auditee1@safetag-audit.org</code></pre></li>
</ul>
<p><strong>Important</strong>: make sure that the ports you use don't conflict with ports by other services or auditees, i.e. don't use a port number twice.</p>
<p>Once this session is open, the auditor can access the auditee's machine (C). At this point there are a few powerful options:</p>
<ul>
<li>simply ssh from S to C via the tunnel (port defined in the reverse tunnel on the server localhost interface);</li>
</ul>
<p><strong>example</strong>:</p>
<p>to connect to site 0:</p>
<pre><code>    ssh clientUser@localhost -p 2200</code></pre>
<p>with site 1 in the previous example, the port would be 2210 (or whatever the auditee used in her command).</p>
<ul>
<li>Create a VPN-like connection to site:
<ul>
<li><p>create a forward tunnel from A to S that is &quot;piped&quot; into the reverse tunnel:</p>
<pre><code>ssh -L 2200:localhost:2200 user@safetag-audit.org</code></pre></li>
</ul>
<p>now you have a tunnel from your localhost:2200 to safetag-audit.org:2200, which in turn has a tunnel from safetag-audit.org:2200 to the client machine on port 22.</p>
<ul>
<li>once you have that, you can use <a href="https://sshuttle.readthedocs.io">sshuttle</a> (needs to be installed, it's in most Linux standard repositories) on the auditor's machine (A) to access additional resources in the auditee's network (as long as they are non-ICMP) directly from the Auditor's machine (A). Such resources might include web-based resources (router web interface for example) or remote desktop (to assess windows or mac clients) or accessing file shares on the auditee's network, etc...</li>
</ul>
<p>to do this, you would need to use client credentials through the tunnel you just created, and provide the client subnet to route traffic correctly through that &quot;VPN&quot;:</p>
<pre><code>    sshuttle -r user@localhost:2200 192.168.1.0/24</code></pre>
<p>once this tunnel is created, you should be able to access any resource on the remote network by its IP and port (for example, through the browser for http(s))</p></li>
</ul>
<p>An additional thing that one might want to do is making the connection from C to S passwordless and automatic (this can be accomplished with tools or scripts readily available on the internet).</p>
<p><strong><em>WARNING</em></strong>: Make sure to remove/clean any persistent connections once you are done with auditing.</p>
<p>There should be no need for multiple reverse tunnels, as multiple forward tunnels can be set up from S to C if needed (eg. VNC or RDP); this requires multiple forward tunnels from A to S though.</p>
<h6 id="scenario-2-1">Scenario 2</h6>
<p><strong>Legend</strong>:</p>
<ul>
<li>A: Auditee's local machine; a clean machine, connected to the Internet through the auditee's LAN network</li>
<li>B: Auditor machine</li>
</ul>
<p>Someone at the auditee's side will prepare machine A in coordination with the auditor, then install <a href="https://www.teamviewer.com/en/">TeamViewer</a>.</p>
<p>After that, and using a trusted communication method, TeamViewer ID and passcode will be sent to the Auditor.</p>
<p>The auditor will use the ID and passcode to connect to the machine and start using machine A as the auditing machine.</p>
<p>There are pros and cons for this:</p>
<p><strong>Cons</strong>:</p>
<ol>
<li>Internet speed: You will need a high speed Internet connection to achieve such task, as the remote access will be transferring the desktop of the targeted machine to you in order to do the tasks.</li>
<li>Connection interruption: While you are working remotely, you might face some connection interruptions during your session, and restarting the remote access will be a challenge because in most of the cases you will need someone at the other end to authorize you to tunnel into the machine.</li>
<li>Physical limitations: You are still physically far from the machine, which means you cannot connect a USB drive to boot from it or do any other tasks that require you to be near the device.</li>
<li>Installing Kali Linux might be hard: It might be hard for a non-technical person to prepare a Kali Linux machine</li>
</ol>
<p><strong>Pros</strong>:</p>
<ol>
<li>Usability: TeamViewer is easy to install and use. Anyone with basic knowledge on how to install software can assist you with preparing the auditing machine.</li>
<li>Network speed: Technically, your auditing machine is the machine you are connected to, which is physically located in the targeted office and connected to the LAN network. This means that you will have full speed running your audit tasks.</li>
</ol>
<p><strong>Note</strong>: Some remote assistant software provides VPN solutions that turn Machine A into a VPN Server and allow Machine B to VPN into it. Tunneling into that VPN server will allow you to connect to the local LAN network, which will allow you to use Machine B to run the audit.</p>
<h6 id="using-an-in-the-middle-trusted-vpn-server">Using an in-the-middle trusted VPN server</h6>
<p><strong>Legend</strong>:</p>
<ul>
<li>A : Auditee's local machine; a clean machine, connected to the Internet through the auditee's LAN network</li>
<li>B: Auditor's machine</li>
<li>C: OpenVPN Server</li>
</ul>
<p>Auditee's Network --------- (A) ---------- C ---------- (B) ---------- Auditor's Network</p>
<p>The auditor will put efforts preparing an OpenVPN server (C) and create 2 profiles (Keys and configurations) to allow machines A and B to connect to C.</p>
<p>Get a VPS from your favorite and trusted VPS provider and keep in mind the physical location of the server, then install OpenVPN Server by following the instructions contained in <a href="https://help.ubuntu.com/lts/serverguide/openvpn.html">this guide on Ubuntu Server</a>.</p>
<p>The default configuration of OpenVPN will not allow the clients (A-B) to see each other on the network. To allow that, you have to enable client-to-client directive and enable your both subnets (Auditee and Auditor) to see each others networks. To do so, follow <a href="https://community.openvpn.net/openvpn/wiki/RoutedLans">these instruction</a>.</p>
<p>After finishing the installation and testing it, the auditor will pass the .ovpn file to the person at the auditee's site through a trusted way, and provide instructions on how to install and connect to the server. After connecting A and B to C, the auditor will be able to start the network and device assessment at the other end.</p>
<p><strong>Note</strong>: In case the VPN is censored in A or B's countries, or in both, you can follow <a href="https://www.pluggabletransports.info/implement/openvpn/">these instructions</a> on how to bypass the censorship by using pluggable transports.</p>
</div></div></body><div class="section categories"><div class="container"><div class="row"><div class="two columns">&nbsp;</div><div class="eight column category"><h4>Developed with ❤ by</h4><a href="https://iilab.org"><img class="u-max-full-width" src="/safetag/@safetag/guide/img/iilab_white.svg"></a><h5>Information Innovation Lab</h5><p>Applied research and development of public interest technology.</p></div><div class="two columns">&nbsp;</div></div></div></div><script>$( document ).ready(function() {
  anchors.options.placement = 'left';
  anchors.add('h1,h2,h3');
})
</script></html>